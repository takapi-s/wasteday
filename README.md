# Wasteday - 無駄時間可視化デスクトップアプリ

PC上の「浪費時間（SNS・動画・ゲーム等）」を自動で記録・集計し、当日どの程度"無駄にしたか"を一目で把握できるデスクトップアプリケーションです。現在はデスクトップアプリ（Tauri）に特化し、データはすべてローカル（SQLite）に保存します。オンラインデータベースやSupabaseの設定は不要です。

## ダウンロード

最新版のWastedayをダウンロードしてインストールできます：

[![Download Latest Release](https://img.shields.io/badge/Download-Latest%20Release-blue?style=for-the-badge&logo=github)](https://github.com/takapi-s/wasteday/releases/latest)

- **対応OS**
  - Windows: MSIインストーラーまたはポータブル版（EXE）
  - macOS / Linux: 将来対応予定

## 概要

- **デスクトップアプリ**: アプリ別（exe）の使用状況を自動サンプリング（既定5秒）
- **ブラウザ拡張**: ドメイン別のブラウジング時間を自動追跡（HTTP通信）
- 「浪費（waste）」/「生産的（productive/neutral）」カテゴリに基づいてローカルDBに自動保存
- ダッシュボードで当日・週次・月次の統計を可視化
- アプリ/ドメインのカテゴリ管理（発見済み識別子の表示とワンクリック登録）
- 自動起動（OSログイン時）のON/OFF切り替え
- ダーク/ライト/システムテーマ

## 技術スタック（現構成）

- デスクトップ: Tauri (Rust + React + TypeScript)
- UI: React + Tailwind CSS（共有UIパッケージ `@wasteday/ui` を利用）
- データ保存: ローカルSQLite（Tauriコマンド経由）
- サンプリング/セッション化: `@wasteday/ingest`

## プロジェクト構造（抜粋）

```
wasteday/
├── apps/
│   ├── desktop/        # デスクトップアプリ本体（Tauri）
│   └── chrome-extension/ # Chrome拡張機能（ブラウジング追跡）
├── packages/
│   ├── ui/             # 共有UIコンポーネント
│   ├── ingest/         # サンプリングとセッション確定処理
│   └── localdb/        # ローカルDB向け型/API
└── README.md
```

## デスクトップアプリの主な画面・機能

- **ダッシュボード**（`apps/desktop/src/pages/DashboardPage.tsx`）
  - 過去24時間の時系列（アクティブ/アイドル秒）
  - 当日の合計（浪費時間/非浪費時間）
  - 上位アプリ/ドメイン（浪費・生産的）
  - 週次/月次表示（過去との比較指標含む）
- **アプリ/ドメイン管理**（`apps/desktop/src/pages/AppManagementPage.tsx`）
  - 登録済みカテゴリの一覧・有効/無効切り替え
  - 過去セッションからの「未登録の識別子」を検出して提示
  - 新規カテゴリの追加・削除
- **設定**（`apps/desktop/src/pages/SettingsPage.tsx`）
  - 自動起動のON/OFF（`@tauri-apps/plugin-autostart`）
  - テーマ切替（ライト/ダーク/システム）
  - サンプリング/アイドル閾値などの設定保存（ローカル）

### データの取り込み（Ingest）

#### デスクトップアプリ
- フォアグラウンドのウィンドウ情報とアイドル秒をTauri（Rust）で取得
- `@wasteday/ingest` が5秒ごとにサンプルを処理し、ギャップ条件やキー変更を契機にセッションを確定
- セッションは `session_key`（例: `category=app;identifier=chrome.exe;user_state=active`）でメタ情報を持ち、ローカルDBに保存

#### ブラウザ拡張
- Chrome拡張機能がタブの変更・アクティブ化・ウィンドウフォーカスを監視
- HTTP通信（localhost:5606）でデスクトップアプリにブラウジングデータを送信
- ドメイン別の滞在時間を計測し、`browsing_sessions`テーブルに保存
- ブラウザ非フォーカス時は追跡を一時停止し、正確なアクティブ時間のみを記録

### ローカルDB集計

- `useLocalDbData`（当日/24h）: `db_get_sessions`, `db_list_waste_categories` を呼び出し、時間帯別にバケット集計
- `useLocalWeeklyData`（週次）: 週の開始日から日別の浪費/生産的秒を算出、前週比較を計算
- `useLocalMonthlyData`（月次）: カレンダーグリッド/週次合計/前月比較を計算
- `useLocalAppCategories`（カテゴリ管理）: 30日分のセッションから未登録識別子を検出、CRUDを提供

## セットアップ（開発者向け）

### 前提条件

- Node.js 18+
- Rust（Tauri）
- pnpm / npm いずれか

### 1. 依存関係インストール

```bash
npm install
```

### 2. デスクトップアプリの起動

```bash
cd apps/desktop
npm run dev
```

Tauriのウィンドウが立ち上がり、5秒ごとにサンプリングが始まります。初回起動時にローカルDBが自動作成されます。

### 3. Chrome拡張機能の起動（オプション）

```bash
# Chrome拡張機能を開発者モードで読み込み
# 1. Chrome拡張機能のデベロッパーモードを有効化
# 2. 「パッケージ化されていない拡張機能を読み込む」をクリック
# 3. apps/chrome-extension フォルダを選択
```

拡張機能をインストールすると、ブラウジングデータも自動的に追跡されます。

### 4. ビルド

```bash
# ルートで全体ビルド
npm run build

# デスクトップアプリ単体ビルド
cd apps/desktop && npm run build
```

### CI/配布方針（dist 非コミット / タグ駆動リリース）

- 本リポジトリでは、ビルド成果物 `dist/` をコミットしません（`.gitignore` で除外）。
- Pull Request / main への push では CI が `install → build` を実行して検証のみを行います。
- `v*` 形式のタグを push した時だけ、CI がビルド後に `dist/` をアーティファクトとしてアップロードします（リリース扱い）。
- これにより、レビュー時の差分が軽量化され、常にクリーンな再現ビルドが保証されます。

## 設定

- データはローカルSQLiteに保存されます。外部サービスの設定は不要です。
- サンプリング間隔やアイドル閾値はアプリ設定から調整可能です（既定: サンプリング5秒、アイドル60秒）。
- 自動起動は設定画面から切り替えできます。

## 料金 / プラン（方針）

- **無料**: ローカル保存・全てのオフライン機能
- **サブスク（予定）**: オンラインデータベースによる複数デバイス同期、高度な分析、オンラインバックアップ など
  - サブスクはあくまでクラウド機能に対して課金し、ローカル利用は無料のまま提供します

## 将来計画（Roadmap）

- オンライン同期（クラウドDB）
  - 複数デバイス間のデータ同期・マージ
  - 衝突解決戦略（例: サーバー優先/クライアント優先/マージ）
  - 暗号化とプライバシー配慮（エンドツーエンド暗号化の検討）
- サブスクリプション課金
  - オンライン同期や高度な分析、バックアップ等を有料機能として提供
  - 無料版はローカルのみで引き続き利用可能
- マルチプラットフォーム
  - macOS / Linux 対応
- ブラウザ拡張機能の拡張
  - より細かなドメイン/URLルール
  - 他のブラウザ（Firefox、Edge）への対応

## よくある質問

- Q: オンライン同期はできますか？
  - A: 現在はローカルのみ対応です。将来的に提供予定のオンライン同期はサブスク対象機能になります。
- Q: どの情報が記録されますか？
  - A: デスクトップアプリでは実行中アプリの実行ファイル名（例: `chrome.exe`）やウィンドウタイトル、操作状態（active/idle）のメタ情報と滞在秒数をローカルに保存します。ブラウザ拡張では訪問したドメイン、URL、ページタイトル、滞在時間をローカルに保存します。
- Q: ブラウザ拡張機能は必要ですか？
  - A: 必須ではありません。デスクトップアプリのみでも使用できますが、ブラウザ拡張をインストールするとより詳細なブラウジング時間を追跡できます。

## ライセンス

MIT

- 本リポジトリはMITライセンスの下で提供され、商用利用やフォークが可能です。
- 将来的に提供する「ホスト型オンライン同期サービス」や一部有料機能は、別ライセンス/利用規約で提供される場合があります（オープンソース版のMITは維持）。

## Contributing（貢献のしかた）

オープンソースでの開発を歓迎します。バグ報告・機能提案・ドキュメント修正・コード貢献など、お気軽にどうぞ。

### 貢献フロー

1. Issue を検索し、既存の議論がないか確認
2. 新規 Issue を作成（バグ/機能/改善のテンプレを利用）
3. 作業前に簡単な設計や方針をIssueで共有して合意
4. フォークしてブランチ作成（例: `feat/...`, `fix/...`, `docs/...`）
5. ローカルで開発・ビルド・動作確認
6. 小さめのPRを作成し、変更点・動機・スクリーンショット（UI変更がある場合）を記載

### コーディング規約（概要）

- TypeScript/React: 可読性重視、意味のある命名、早期return、不要な深いネスト禁止
- 例外は握り潰さず、ユーザー向けメッセージは控えめに（コンソールはOK）
- UIは `@wasteday/ui` を活用し、アプリ側はデータ取得と連携に集中
- Tauriコマンド呼び出しは`invoke`経由。型は明示し、可能な限り安全に扱う

### コミット/PR

- Conventional Commits 推奨（例: `feat: add weekly comparison to dashboard`）
- 1PR 1トピックを目安にし、レビューしやすい粒度で
- 破壊的変更は `BREAKING CHANGE:` を記載

### 開発のヒント

- ダッシュボードやカテゴリ管理のデータは、`apps/desktop/src/hooks` のロジックに集約されています
- ローカルDBのスキーマやコマンドは Tauri 側（`apps/desktop/src-tauri`）を参照してください
- 新しい識別子（アプリ/ドメイン）は管理画面から即時に追加できます

---

プロジェクトへの貢献を心よりお待ちしています。

## 開発スタイル

本プロジェクトの多くは「バイブコーディング（Vibe Coding）」のアプローチで作成しています。厳密な仕様策定に先んじて、手を動かしながらUXと要件を素早く往復検証し、ローカルで動く最小価値から段階的に磨き込んでいます。粗い部分や改善余地があれば、ぜひIssue/PRでご提案ください。
