# WasteDay Chrome Extension

WasteDayデスクトップアプリケーションと連携するChrome拡張機能です。ブラウジング活動を自動的に追跡し、ドメイン別の時間計測データをデスクトップアプリに送信します。

## 機能

- **自動ブラウジング追跡**: アクティブなタブの変更を監視し、ドメイン別の滞在時間を計測
- **HTTP通信**: Chrome拡張機能とデスクトップアプリ間の軽量HTTP通信（localhost:5606）
- **リアルタイムデータ送信**: ブラウジングデータをリアルタイムでWasteDayアプリに送信
- **ヘルスチェック**: 接続状態の監視と自動回復
- **ポップアップ統計**: 現在のセッション状況と接続状態を表示
- **ドメイン分類**: 訪問したドメインを自動的に分類・管理

## インストール方法

### 1. デスクトップアプリの準備

まず、WasteDayデスクトップアプリケーションを起動してください：

```bash
cd apps/desktop
npm run tauri dev
```

または、リリース版をダウンロードしてインストール：
- [GitHub Releases](https://github.com/takapi-s/wasteday/releases/latest) から最新版をダウンロード

### 2. Chrome拡張機能のインストール

1. Chrome拡張機能のデベロッパーモードを有効化
2. 「パッケージ化されていない拡張機能を読み込む」をクリック
3. `apps/chrome-extension`フォルダを選択

## 使用方法

1. Chrome拡張機能をインストール後、拡張機能アイコンをクリック
2. ポップアップで接続状態を確認（「接続済み」または「接続テスト」ボタンで確認）
3. 通常通りブラウジングを行うと、自動的にデータが収集・送信されます
4. ポップアップで現在のセッション状況や一時停止状態を確認できます

## データ収集内容

- **URL**: 訪問したWebページのURL
- **ドメイン**: 抽出されたドメイン名
- **タイトル**: ページタイトル
- **滞在時間**: ドメインでの滞在時間（秒）
- **タイムスタンプ**: アクセス時刻
- **タブID**: Chromeのタブ識別子

## プライバシー

- データはローカルのWasteDayアプリケーション（localhost:5606）にのみ送信されます
- 外部サーバーには一切送信されません
- 収集されたデータは、ユーザーのローカルデータベース（SQLite）に保存されます
- ブラウザが非フォーカス時は追跡を一時停止し、正確なアクティブ時間のみを記録します

## トラブルシューティング

### デスクトップアプリに接続できない

1. WasteDayデスクトップアプリが起動していることを確認
2. デスクトップアプリがポート5606でHTTPサーバーを起動していることを確認
3. Chrome拡張機能の「接続テスト」ボタンを実行
4. ブラウザで `http://127.0.0.1:5606/api/health` にアクセスして応答を確認

### データが送信されない

1. 拡張機能の権限設定を確認（tabs, activeTab, storage, alarms）
2. デスクトップアプリのログを確認
3. Chrome拡張機能のデベロッパーツールでエラーを確認
4. 一時停止ボタンが有効になっていないことを確認

## 開発

### ローカル開発環境

```bash
# 拡張機能の開発
cd apps/chrome-extension
npm run dev

# デスクトップアプリの開発
cd apps/desktop
npm run tauri dev
```

### ビルド

```bash
# 拡張機能のパッケージ化
cd apps/chrome-extension
npm run package
```

## ライセンス

MIT License
