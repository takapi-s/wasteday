1. 目的・対象範囲

目的：PC上の「浪費時間（SNS・動画・ゲーム等）」を自動で記録・集計し、当日どの程度“無駄にしたか”を一目で把握できるようにする。

対象OS：Windows（10/11）

利用者：本人（個人用途）。初期リリースはローカル保存のみ、クラウド同期なし。

スコープ：

アプリ別（例：Discord, Steam, Riotクライアント, ゲームEXE）

ブラウザ内ドメイン別（例：youtube.com, x.com, tiktok.com）
※モバイル・他OSは対象外

2. ユーザーストーリー

U1：PC作業後、アプリを開くと「今日の浪費合計（分）」と上位ドメイン/アプリが確認できる。

U2：YouTube学習チャンネル視聴は「浪費」に入れたくないので除外ルールを設定できる。

U3：1日の浪費が目標時間（例：60分）を超えたら通知を受ける。

U4：「浪費割合（％）」をPCアクティブ時間に対する比率と、24時間に対する比率の2軸で見られる。

U5：週次の推移（先週比）と時間帯の偏り（ヒートマップ）で傾向を把握できる。

3. 計測要件
3.1 収集対象

アプリ前面情報（Windows API）

GetForegroundWindow → ハンドル

GetWindowThreadProcessId → process_name.exe

GetWindowText → ウィンドウタイトル（必要に応じて）

アイドル状態

GetLastInputInfo によりユーザー不在を検知

画面ロック/スリープはカウント停止（Session Switchなどのイベント利用は後続拡張）

ブラウザのドメイン

推奨：Chrome/Edge拡張からネイティブメッセージングでURLを送信（最も確実）

代替（精度低）：ウィンドウタイトル解析（YouTubeは可能だが他サイトは不安定）

3.2 サンプリングとセッション化

サンプリング間隔：5秒（設定で3〜10秒に可変）

セッション定義：

キー＝{category（app/domain）, identifier（exe名またはドメイン）, user_state}

直前サンプルと同一キーが連続し、中断ギャップが閾値（例：20秒）未満なら同一セッションに結合

アイドルの扱い：

画面ロック/スリープ/ユーザー不在（入力なし）中は原則カウントしない

ただし**「動画視聴」など**は無操作でも浪費とみなしたいケースがあるため例外規則を設ける（下記3.3）

3.3 ブラウザ内特殊判定（動画・音声）

浪費ドメインかつ以下のいずれかであれば無操作でもカウント継続：

tabs[audible] === true（Chrome/Edge API）

コンテンツスクリプトでHTML5 videoの !paused && currentTime変化 を検知（YouTube等、対象サイト限定）

例外停止：ウィンドウがバックグラウンド／タブ非アクティブ時は原則カウント停止（PIP等は拡張で要検出）

4. 判定ロジック・分類
4.1 カテゴリとルール

浪費カテゴリ：ドメイン/アプリで定義（編集可能）

例：youtube.com, x.com, tiktok.com, instagram.com, reddit.com

例：steam.exe, LeagueClient.exe, VALORANT.exe, discord.exe

除外ルール（ホワイトリスト）：

ドメイン＋パス/クエリの部分一致/正規表現

YouTubeチャンネルID指定（学習用途の除外）

ラベル：waste（浪費）/ neutral / study 等。MVPは waste と non-waste の2値で良い。

4.2 「1日のどのくらい無駄か」の定義

指標A（推奨・主要指標）：

浪費割合A = 浪費時間 / PCアクティブ時間（入力あり + メディア視聴例外）

指標B（補助）：

浪費割合B = 浪費時間 / 24時間

表示：当日「浪費合計 hh:mm」とともに、**ゲージ（リング）**で割合A/Bを併記

5. 可視化（UI要件）
5.1 ダッシュボード（デスクトップアプリ）

今日の浪費：

大きな数値（hh:mm）＋ 割合A/B のリングゲージ

進捗バー（今日の目標 60分中 X分）

ドメイン/アプリTOP5：棒グラフ（縦）＋一覧（クリックで当日タイムラインにジャンプ）

時間帯ヒートマップ：24×1（または 24×7 週ビュー）セルで濃淡表示

当日タイムライン：15分粒度で浪費・非浪費を色分け

5.2 週次ビュー

日別合計の棒グラフ、先週比（％）、ランキングの変化

5.3 トレイメニュー

今日の浪費合計（分）と直近TOP3の簡易表示、設定画面への導線

6. 設定（初期値含む）

浪費ドメイン初期値：youtube.com, x.com, tiktok.com, instagram.com, reddit.com

浪費アプリ初期値：steam.exe, LeagueClient.exe, VALORANT.exe, discord.exe

除外ルール：任意追加（YouTube学習チャンネルID、コースサイト等）

目標時間（分）：平日60、休日90（曜日別プロフィールはv0.2以降）

サンプリング間隔：5秒

アイドル閾値：60秒

通知：目標超過時、連続視聴30分時（ON/OFF）

7. 技術構成
7.1 デスクトップアプリ

基盤：Tauri（Rust + React/Tailwind）を推奨（軽量・配布容易）。

Windows API呼び出し：Rustで実装（windows crate）

DB：SQLite（rusqlite）

常駐：起動時にタスクトレイ常駐、自己更新は後続

7.2 ブラウザ拡張（Chrome/Edge）

Manifest V3：tabs, storage, activeTab, scripting

URL収集：chrome.tabs.onUpdated/onActivated でアクティブURL/可聴状態を監視

コンテンツスクリプト（対象サイト限定）：video再生状態をポスト

ネイティブメッセージング：

拡張 → ネイティブホストへJSON送信

ホストはTauriアプリ（EXE）。レジストリ登録し、allowed_origins に拡張IDを指定